"use client";
import { motion as m, useAnimate, stagger, useInView } from "motion/react";
import { useEffect, useState, useRef } from "react";
import { useStore } from "@/state/store";
import Player from "@vimeo/player";
import ScrollDown from "@/components/ScrollDown";

const Hero = ({ vimeoURLs }) => {
  const [scope, animate] = useAnimate();
  const player = useRef(null);
  const container = useRef(null);
  const [loaded, setLoaded] = useState(false);
  const [vimeoURL] = useState(
    vimeoURLs[Math.floor(Math.random() * vimeoURLs.length)]
  );
  const isInView = useInView(scope, { amount: "all" });
  const { setHeaderScrolled, headerScrolled } = useStore();

  useEffect(() => {
    const sequence = async () => {
      // Animate the firstname
      animate(
        ".firstname",
        { filter: "blur(0px)", y: 0, scale: 1 },
        { duration: 1.5 }
      );

      // Animate the surname
      await animate(
        ".surname",
        { filter: "blur(0px)", y: 0, scale: 1 },
        { duration: 1.5, delay: 0.35 }
      );

      // Wait 500ms
      await new Promise((resolve) => setTimeout(resolve, 500));

      // Wait for loaded if not already true
      if (!loaded) {
        await new Promise((resolve) => {
          const checkLoaded = setInterval(() => {
            if (loaded) {
              clearInterval(checkLoaded);
              resolve();
            }
          }, 100);
        });
      }

      // Animate the container
      await animate(
        container.current,
        { filter: "blur(0px)", opacity: 1 },
        { duration: 1.5, ease: "circInOut" }
      );

      // Cleanup styles after animation
      if (container.current) {
        container.current.style.removeProperty("transform");
        container.current.style.removeProperty("opacity");
        container.current.style.removeProperty("filter");
        container.current.style.removeProperty("transform-origin");
      }
    };

    sequence();
  }, [animate, loaded]);

  useEffect(() => {
    console.log({ isInView });
    setHeaderScrolled(!isInView);
  }, [isInView]);

  useEffect(() => {
    console.log({ headerScrolled });
  }, [headerScrolled]);

  useEffect(() => {
    // Initialize the Vimeo Player
    if (player.current) {
      player.current.addEventListener("canplay", () => {
        setLoaded(true);
      });
    }
  }, [player]);

  return (
    <article
      className="vimeo-container grid grid-cols-1 grid-rows-1 h-screen w-full snap-start"
      ref={scope}
    >
      <div className="max-md:px-8 col-start-1 row-start-1 flex items-center justify-center w-full h-full z-10 gap-4 md:gap-8">
        <div className="firstname scale-[1.5] blur-[64px] max-w-full">
          <svg
            width="310"
            height="110"
            viewBox="0 0 410 142"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="max-w-full"
          >
            <g>
              <path
                d="M371.123 114.5C349.673 114.5 336.023 99.5 336.023 76.4C336.023 52.55 348.473 37.25 369.473 37.25C387.173 37.25 399.473 49.25 399.473 76.25H344.123C344.423 97.85 354.773 111.8 374.123 111.8C383.273 111.8 392.723 107.45 399.773 99.95L400.523 100.7C393.623 108.95 382.973 114.5 371.123 114.5ZM344.123 74.75H379.073C389.573 74.75 391.823 69.5 391.823 63.05C391.823 50.9 384.623 38.6 369.023 38.6C352.823 38.6 344.273 53.45 344.123 74.75Z"
                fill="white"
              />
              <path
                d="M298.767 95C298.767 106.55 301.467 111.05 309.717 112.55V113H281.067V112.55C289.317 111.05 292.017 106.55 292.017 95V65.75C292.017 54.35 290.517 47.6 281.067 45.95V45.5C288.417 44.75 295.317 41.45 298.317 37.25H298.767V61.85C302.667 46.85 311.817 37.25 322.317 37.25C326.817 37.25 328.917 39.8 328.917 42.5C328.917 45.35 326.817 47.6 323.817 47.45C320.667 47.3 319.317 45.05 318.567 43.25C318.117 42.05 317.667 41.6 316.467 41.6C307.317 41.6 298.767 58.85 298.767 71.75V95Z"
                fill="white"
              />
              <path
                d="M225.869 114.5C208.319 114.5 194.519 99.8 194.519 78.5C194.519 54.5 207.269 37.25 229.019 37.25C239.819 37.25 248.969 42.35 252.269 44.3V28.85C252.269 17.45 250.769 10.7 241.319 9.05001V8.60001C248.669 7.85001 255.569 4.55001 258.569 0.350006H259.019V93.2C259.019 107.45 261.569 109.7 269.069 110.45V110.9C263.969 111.65 259.619 112.7 252.869 114.5H252.269V90.95C247.469 105.8 238.019 114.5 225.869 114.5ZM202.619 75.05C202.619 99.05 212.969 112.55 227.519 112.55C240.569 112.55 251.969 98.75 252.269 77.75V49.4C248.369 44.45 241.319 38.6 227.969 38.6C212.519 38.6 202.619 53.3 202.619 75.05Z"
                fill="white"
              />
              <path
                d="M154.556 113V112.55C162.806 111.05 165.506 106.55 165.506 95V65.75C165.506 48.35 158.456 39.35 144.956 39.35C130.706 39.35 120.056 54.5 120.056 75.05V95C120.056 106.55 122.756 111.05 131.006 112.55V113H102.356V112.55C110.606 111.05 113.306 106.55 113.306 95V65.75C113.306 54.35 111.806 47.6 102.356 45.95V45.5C109.706 44.75 116.606 41.45 119.606 37.25H120.056V61.85C122.156 51.35 130.856 37.25 147.206 37.25C163.706 37.25 172.256 47 172.256 65.75V95C172.256 106.55 174.956 111.05 183.206 112.55V113H154.556Z"
                fill="white"
              />
              <path
                d="M0.174316 112.55C7.07432 110.9 11.5743 105.35 16.2243 92.15L44.5743 11.75C46.5243 9.95 48.7743 8.3 50.4243 6.5H51.0243L81.9243 93.8C84.7743 101.75 88.5243 111.05 97.0743 112.55V113H67.0743V112.55C73.5243 111.35 75.9243 107.75 75.9243 102.95C75.9243 100.25 75.1743 97.4 74.1243 94.25L66.4743 72.65H25.0743L18.3243 91.7C17.1243 95.3 16.3743 98.6 16.3743 101.75C16.3743 107 18.7743 111.05 24.7743 112.55V113H0.174316V112.55ZM25.6743 71H65.8743L45.9243 14.75H45.4743L25.6743 71Z"
                fill="white"
              />
            </g>
          </svg>
        </div>
        <div className="surname relative scale-[1.5] blur-[64px] max-w-full">
          <div className="bg">
            <svg
              width="454"
              height="110"
              viewBox="0 0 581 142"
              fill="none"
              className="max-w-full"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g>
                <path
                  d="M549.441 107H515.691V106.55C523.941 105.05 526.641 100.55 526.641 89V50.75C526.641 39.2 523.941 34.7 515.691 33.2V32.75H526.941C534.141 32.75 540.141 32 548.691 32C564.291 32 574.491 38.6 574.491 48.8C574.491 59.45 565.641 65.9 555.591 67.25V67.7C569.691 67.7 580.791 74.15 580.791 85.7C580.791 98.9 568.491 107 549.441 107ZM551.091 105.65C564.891 105.65 572.541 99.05 572.541 86.3C572.541 74.9 564.291 68.3 548.691 68.3H533.241V91.1C533.241 98.75 533.541 105.65 548.691 105.65H551.091ZM548.691 66.8C561.441 66.8 566.691 59.45 566.691 49.85C566.691 38.3 558.591 33.35 548.841 33.35H547.191C535.191 33.35 533.241 40.55 533.241 49.1V66.8H548.691Z"
                  fill="white"
                />
                <path
                  d="M475.412 108.5C453.962 108.5 440.312 93.5 440.312 70.4C440.312 46.55 452.762 31.25 473.762 31.25C491.462 31.25 503.762 43.25 503.762 70.25H448.412C448.712 91.85 459.062 105.8 478.412 105.8C487.562 105.8 497.012 101.45 504.062 93.95L504.812 94.7C497.912 102.95 487.262 108.5 475.412 108.5ZM448.412 68.75H483.362C493.862 68.75 496.112 63.5 496.112 57.05C496.112 44.9 488.912 32.6 473.312 32.6C457.112 32.6 448.562 47.45 448.412 68.75Z"
                  fill="white"
                />
                <path
                  d="M397.482 108.5C376.032 108.5 362.382 93.5 362.382 70.4C362.382 46.55 374.832 31.25 395.832 31.25C413.532 31.25 425.832 43.25 425.832 70.25H370.482C370.782 91.85 381.132 105.8 400.482 105.8C409.632 105.8 419.082 101.45 426.132 93.95L426.882 94.7C419.982 102.95 409.332 108.5 397.482 108.5ZM370.482 68.75H405.432C415.932 68.75 418.182 63.5 418.182 57.05C418.182 44.9 410.982 32.6 395.382 32.6C379.182 32.6 370.632 47.45 370.482 68.75Z"
                  fill="white"
                />
                <path
                  d="M312.316 108.5C301.516 108.5 292.366 103.4 289.066 101.45V123.5C289.066 135.05 291.766 139.55 300.016 141.05V141.5H271.366V141.05C279.616 139.55 282.316 135.05 282.316 123.5V59.75C282.316 48.35 280.816 41.6 271.366 39.95V39.5C278.716 38.75 285.616 35.45 288.616 31.25H289.066V54.8C293.866 39.95 303.316 31.25 315.466 31.25C333.016 31.25 346.816 46.4 346.816 67.7C346.816 91.7 334.066 108.5 312.316 108.5ZM289.066 96.35C292.966 101.3 300.016 107.15 313.366 107.15C328.816 107.15 338.716 92.9 338.716 71.15C338.716 47.15 328.366 33.2 313.816 33.2C300.766 33.2 289.366 47.45 289.066 68.45V96.35Z"
                  fill="white"
                />
                <path
                  d="M186.307 106.55C196.957 105.2 201.607 97.85 203.257 84.2L207.457 47.9C208.357 39.8 207.157 34.7 199.807 33.2V32.75H258.307V33.2C250.057 34.7 247.357 39.2 247.357 50.75V89.75C247.357 99.8 250.507 105.05 262.657 106.55V129.5H262.207C258.457 112.7 254.407 107 242.857 107H207.307C197.257 107 190.507 114.2 186.757 129.5H186.307V106.55ZM224.257 105.5C235.657 105.5 240.757 100.25 240.757 89.75V49.1C240.757 42.2 237.907 34.25 228.457 34.25H222.007C214.057 34.25 210.157 39.05 209.257 47.15L205.057 82.85C203.407 97.4 200.407 101.15 194.707 105.5H224.257Z"
                  fill="white"
                />
                <path
                  d="M100.701 107V106.55C108.951 105.05 111.651 100.55 111.651 89V50.75C111.651 39.2 108.951 34.7 100.701 33.2V32.75H129.201V33.2C120.951 34.7 118.251 39.2 118.251 50.75V67.25H162.051V50.75C162.051 39.2 159.351 34.7 151.101 33.2V32.75H179.601V33.2C171.351 34.7 168.651 39.2 168.651 50.75V89C168.651 100.55 171.351 105.05 179.601 106.55V107H151.101V106.55C159.351 105.05 162.051 100.55 162.051 89V68.75H118.251V89C118.251 100.55 120.951 105.05 129.201 106.55V107H100.701Z"
                  fill="white"
                />
                <path
                  d="M0.0195312 106.55C6.91953 104.9 11.4195 99.35 16.0695 86.15L44.4195 5.75001C46.3695 3.95 48.6195 2.3 50.2695 0.5H50.8695L81.7695 87.8C84.6195 95.75 88.3695 105.05 96.9196 106.55V107H66.9195V106.55C73.3695 105.35 75.7695 101.75 75.7695 96.95C75.7695 94.25 75.0195 91.4 73.9695 88.25L66.3195 66.65H24.9195L18.1695 85.7C16.9695 89.3 16.2195 92.6 16.2195 95.75C16.2195 101 18.6195 105.05 24.6195 106.55V107H0.0195312V106.55ZM25.5195 65H65.7195L45.7695 8.75H45.3195L25.5195 65Z"
                  fill="white"
                />
              </g>
            </svg>
          </div>
        </div>
      </div>
      <m.div
        className="row-start-1 col-start-1  relative"
        ref={container}
        initial={{ filter: "blur(64px)", opacity: 0 }}
      >
        <video
          src={vimeoURL}
          className="w-full h-full object-cover"
          autoPlay
          loop
          playsInline
          muted
          ref={player}
        ></video>
      </m.div>
      {!headerScrolled && <ScrollDown />}
    </article>
  );
};

export default Hero;
